if (self.CavalryLogger) { CavalryLogger.start_js(["6WRRp"]); }

__d("FileForm",["ArbiterMixin","AsyncRequest","AsyncResponse","AsyncUploadRequest","BehaviorsMixin","CurrentUser","DataStore","DOMQuery","Event","Form","JSONPTransport","Parent","URI","isElementNode","mixin","setTimeout","shield"],(function(a,b,c,d,e,f){var g;function h(a){var c={};a=b("DOMQuery").scry(a,'input[type="file"]');a.forEach(function(a){c[a.name]=a.files});return c}function i(a){a=b("DOMQuery").scry(a,'input[type="file"]');a.forEach(function(a){a.files=null})}a=function(a){babelHelpers.inheritsLoose(c,a);function c(c,d,e){var f;f=a.call(this)||this;f._handleSubmit=function(a){if(a.isDefaultPrevented()||a.getTarget()!==f._form)return;if(f.inform("submit")===!1){a.prevent();return}f.submit(a)};f.initial=function(a){return f.inform("initial",{upload:a})};if(c.getAttribute("rel")==="async")throw new Error("FileForm cannot be used with Primer forms.");if((c.getAttribute("method")||"").toUpperCase()!=="POST")throw new Error("FileForm must be used with POST forms.");f._form=c;f._previousEncoding=f._form.enctype;f._form.enctype=f._form.encoding="multipart/form-data";f._files=null;f._customHeader={};d&&f.enableBehaviors(d);f._options=e||{};f.setAllowCrossOrigin(f._options.allowCrossOrigin);f.setAllowCrossPageTransition(f._options.allowCrossPageTransition);f.setUploadInParallel(f._options.uploadInParallel);f.setConcurrentLimit(f._options.concurrentLimit);f.setPreprocessHandler(f._options.preprocessHandler);f.setNetworkErrorRetryLimit(f._options.networkErrorRetryLimit);f._listeners=[b("Event").listen(document.documentElement,"submit",f._handleSubmit),b("Event").listen(f._form,"click",f._click.bind(babelHelpers.assertThisInitialized(f)))];b("DataStore").set(f._form,"FileForm",babelHelpers.assertThisInitialized(f));return f}var d=c.prototype;d.getRoot=function(){return this._form};d.setAllowCrossOrigin=function(a){this._allowCrossOrigin=!!a;return this};d.setAllowCrossPageTransition=function(a){this._allowCrossPageTransition=!!a;return this};d.setUploadInParallel=function(a){this._uploadInParallel=!!a;return this};d.setConcurrentLimit=function(a){this._concurrentLimit=a;return this};d.setCustomHttpHeader=function(a,b){this._customHeader[a]=b;return this};d.setPreprocessHandler=function(a){this._preprocessHandler=a;return this};d.setNetworkErrorRetryLimit=function(a){this._retryLimit=a;return this};d.setFiles=function(a){this._files=a;return this};d.canUseXHR=function(){var a="FormData"in window;a&&(!new(g||(g=b("URI")))(this._form.action).isSameOrigin()&&!this._allowCrossOrigin&&(a=!1));return a};d._click=function(a){a=a.getTarget();while(b("isElementNode")(a)){if(a.type==="submit"){this._clickTarget=a;b("setTimeout")(this._unclick.bind(this),0);break}a=a.parentNode}};d._unclick=function(){this._clickTarget=null};d._sendViaFrame=function(){var a=this._request=new(b("AsyncRequest"))();a.setStatusElement(this._getStatusElement());a.addStatusIndicator();a.setOption("useIframeTransport",!0);var c=a.handleResponse.bind(a);c=new(b("JSONPTransport"))("iframe",this._form.action,c);var d=c.getTransportFrame(),e=c.getRequestURI().addQueryData({__iframe:!0,__user:b("CurrentUser").getID()});this._form.setAttribute("action",e.toString());c.createContinuationForFileForm_DO_NOT_USE();this._form.setAttribute("target",d.name);a.setJSONPTransport(c);a.setURI(e);a.setHandler(this.success.bind(this,null));a.setErrorHandler(this.failure.bind(this,null));a.setInitialHandler(b("shield")(this.initial,this,null))};d._sendViaXHR=function(a){var c=this,d;if(this._uploadInParallel&&b("AsyncUploadRequest").isSupported()){d=new(b("AsyncUploadRequest"))().setPreprocessHandler(this._preprocessHandler).setData(b("Form").serialize(this._form,this._clickTarget)).setNetworkErrorRetryLimit(this._retryLimit);for(var e in this._customHeader)d.setCustomHttpHeader(e,this._customHeader[e]);this._concurrentLimit&&d.setLimit(this._concurrentLimit);this._files?d.setFiles(this._files):d.setFiles(h(this._form));var f=[d.subscribe("progress",function(a,b){this.progress(b,b.getProgressEvent())}.bind(this)),d.subscribe("initial",function(a,b){this.initial(b)}.bind(this)),d.subscribe("success",function(a,b){this.success(b,b.getResponse())}.bind(this)),d.subscribe("start",function(a,b){this.inform("start",{upload:b})}.bind(this)),d.subscribe("failure",function(a,b){this.failure(b,b.getResponse());return!1}.bind(this)),d.subscribe("complete",function(){while(f.length)f.pop().unsubscribe()})]}else{var g,e,i;(function(){var a,f=c._files;if(f){a=b("Form").createFormData(b("Form").serialize(c._form,c._clickTarget));g=b("AsyncUploadRequest").parseFiles(f);for(e in g)i=g[e],i.length===1?a.append(e,i[0]):(e=e+"[]",i.forEach(function(b){a.append(e,b)}))}else a=b("Form").createFormData(c._form,c._clickTarget);d=new(b("AsyncRequest"))().setRawData(a).setHandler(c.success.bind(c,null)).setErrorHandler(c.failure.bind(c,null)).setUploadProgressHandler(c.progress.bind(c,null)).setInitialHandler(b("shield")(c.initial,c,null));c.inform("start",{upload:null})})()}d.setAllowCrossOrigin(this._allowCrossOrigin).setAllowCrossPageTransition(this._allowCrossPageTransition).setRelativeTo(this._form).setStatusElement(this._getStatusElement()).setURI(this._form.action).send();this._request=d;a&&a.prevent()};d.forceSendViaXHR=function(){return this._sendViaXHR(null)};d.success=function(a,c){c={response:c,upload:a};this.inform("success",c)!==!1&&b("Event").fire(this._form,"success",c);this._cleanup()};d.failure=function(a,c){a={response:c,upload:a};this.inform("failure",a)!==!1&&(b("Event").fire(this._form,"error",a)!==!1&&b("AsyncResponse").defaultErrorHandler(c));this._cleanup()};d.progress=function(a,b){this.inform("progress",{event:b,upload:a})};d.abort=function(){this._request&&(this._request.abort(),this._cleanup())};d.clear=function(){i(this._form)};d.destroy=function(){this._cleanup();while(this._listeners&&this._listeners.length)this._listeners.pop().remove();this._listeners=null;this._form.enctype=this._form.encoding=this._previousEncoding;b("DataStore").remove(this._form,"FileForm")};d.submit=function(a){this.canUseXHR()?this._sendViaXHR(a):this._sendViaFrame()};d._cleanup=function(){this._request=null};d._getStatusElement=function(){return b("Parent").byClass(this._form,"stat_elem")||this._form};c.getInstance=function(a){return b("DataStore").get(a,"FileForm")};return c}(b("mixin")(b("ArbiterMixin"),b("BehaviorsMixin")));e.exports=a;Object.assign(a,{EVENTS:["start","submit","initial","progress","success","failure"]})}),null);
__d("PhotosUploadID",[],(function(a,b,c,d,e,f){f.getNewID=a;var g=1024;function a(){return(g++).toString()}}),null);
__d("PRETestMPNDesktopThreadPage.react",["cx","JSResource","LiveChatPluginConstants","LiveChatPluginLoggerUtil","MessagingPluginContext","MPNDesktopDialogHeader.react","MPNEndChatPrompt.react","lazyLoadComponent","MessengerSpinner.react","MPNDesktopGuestUpgradeUpsellPrompt.react","MessengerState.bs","MPNBlockedPageComposer.react","MPNLocalState","MPNDesktopMessageComposer.react","MPNXDMessageManager","MPNConstants","React","UnverifiedXD","MPNIdentity","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=b("lazyLoadComponent")(b("JSResource")("MessagingPluginDialogBody.react").__setRef("PRETestMPNDesktopThreadPage.react")),i=b("MessengerState.bs").jsComponent,j=b("MPNLocalState").MPNChatState,k=b("MPNConstants").MPNUpgradePrompt,l=b("React"),m=b("MPNIdentity").MPNIdentity,n=b("MPNIdentity").MPNIdentityState;a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={dialogBodyHeight:-1},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){var a=b("LiveChatPluginConstants").THREAD_PAGE_HEIGHT+b("LiveChatPluginConstants").THREAD_PAGE_PADDING_HEIGHT;b("MPNXDMessageManager").resizeIframe(a.toString())};d.render=function(){var a=this,c=this.context.state,d=c.optimisticStorageState,e=c.pageID,f=c.isPageBlocked;c=c.showUpgradeUpsellPrompt;var g=m.currentUserID(),o=m.currentUserState()===n.GUEST;try{return l.jsx("div",{role:"none",className:"_94vg",children:l.jsx("div",{className:d.chatState===j.CHAT_NOT_STARTED?"_91hz":"",children:l.jsxs("div",{className:"_94vh",children:[l.jsx(b("MPNDesktopDialogHeader.react"),{ActionDelegate:this.props.ActionDelegate,history:this.props.history}),l.jsx("div",{className:"_424s",children:l.jsx(l.Suspense,{fallback:l.jsx("div",{className:"spinner",children:l.jsx(b("MessengerSpinner.react"),{color:"blue",size:b("MessengerSpinner.react").large_size})}),children:d.chatState!==j.CHAT_NOT_STARTED&&l.jsx(i,{fbid:g,children:function(c){return l.jsx(h,{deliveryReceipt:b("MessengerState.bs").deliveryReceipts(c),dialogBodyHeight:a.state.dialogBodyHeight,messengerState:c,readReceipt:null,sendRef:function(){}})}})})}),d.showUpgradePrompt==null||d.showUpgradePrompt===k.NOT_SHOWN||d.showUpgradePrompt===k.UNSAVED_MSG_UPSELL&&this.context.state.messageCount==null||!c?null:l.jsx(b("MPNDesktopGuestUpgradeUpsellPrompt.react"),{color:this.context.state.threadCSSColor,prompt:this.context.state.optimisticStorageState.showUpgradePrompt,history:this.props.history}),l.jsx(b("MPNEndChatPrompt.react"),{isGuest:o,history:this.props.history,shouldMinimize:!1}),f&&d.chatState===j.LOGGED_IN_CHAT_STARTED?l.jsx(b("MPNBlockedPageComposer.react"),{}):l.jsx(b("MPNDesktopMessageComposer.react"),{onBlur:this.$2()?this.$3:b("emptyFunction"),onChange:function(){},onClick:function(){},onFocus:this.$2()?this.$4:b("emptyFunction"),ref:function(b){return a.$1=b}})]},"dialog_container")})})}catch(a){b("LiveChatPluginLoggerUtil").logImpressionExceptionsFromNewUI("tab_load_failure",e,m.currentUserState()===n.FB?"logged_in_chat_tab":"guest_chat_tab",a.name,a.message,a.stack)}};d.$2=function(){return/iPhone|iPad|iPod/.test(navigator.userAgent)};d.$4=function(){b("UnverifiedXD").send({type:"liveChatPluginFocusComposer"})};d.$3=function(){b("UnverifiedXD").send({type:"liveChatPluginBlurComposer"})};return c}(l.Component);a.contextType=b("MessagingPluginContext");e.exports=a}),null);
__d("PRETestMPNDesktopRoute.react",["MessagingPluginPathUtils","MPNDesktopITPContinuePage.react","MPNDesktopWelcomePage.react","PRETestMPNDesktopThreadPage.react","React","ReactRouterDOM"],(function(a,b,c,d,e,f){e.exports=a;var g=b("React");function a(a){var c=a.path,d=a.ActionDelegate;return g.jsx((a=b("ReactRouterDOM")).BrowserRouter,{children:g.jsxs(a.Switch,{children:[g.jsx(a.Route,{render:function(a){return g.jsx(b("MPNDesktopWelcomePage.react"),babelHelpers["extends"]({},a,{ActionDelegate:d}))},exact:!0,path:b("MessagingPluginPathUtils").MPN_PATH.WELCOME}),g.jsx(a.Route,{render:function(a){return g.jsx(b("MPNDesktopITPContinuePage.react"),babelHelpers["extends"]({},a,{ActionDelegate:d}))},exact:!0,path:b("MessagingPluginPathUtils").MPN_PATH.ITPCONTINUE}),g.jsx(a.Route,{render:function(a){return g.jsx(b("PRETestMPNDesktopThreadPage.react"),babelHelpers["extends"]({},a,{ActionDelegate:d}))},exact:!0,path:b("MessagingPluginPathUtils").MPN_PATH.THREAD}),g.jsx(a.Redirect,{to:c})]})})}}),null);
__d("PRETestMPNDesktopWrapper.react",["Arbiter","AsyncRequest","Bootloader","CreateCustomerChatPluginGuestUserMutation","LiveChatMqttClient","LiveChatPluginConstants","LiveChatPluginLoggerUtil","LiveChatPluginUtils","MessagingPluginContext","MessagingPluginGuestUpgradeActions","MessagingPluginPathUtils","MPNConstants","MPNDesktopIcon.react","MPNIdentity","MPNLocalState","MPNNavigation","MPNStorage","MPNUnreadCountBadge.react","MPNXDMessageManager","Plugin","PluginOptin","PRETestMPNDesktopRoute.react","React","ReactDOM","XMNPlatformCustomerChatPluginOpenThreadController"],(function(a,b,c,d,e,f){"use strict";var g=b("React"),h={NONE:0,CREATE_GUEST_SESSION:1,START_NEW_THREAD:2,GUEST_UPGRADE:3,GUEST_UPGRADE_SWITCH_ACCOUNT:4};a=function(a){babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c)||this;d.actionOnInit=h.NONE;d.iconIframeLoaded=!1;d.$2=null;d.initialPath=d.$4();d.props.redirectCommand==b("MPNConstants").MPNRedirect.NEW_GUEST_SESSION?d.actionOnInit=h.CREATE_GUEST_SESSION:d.props.redirectCommand==b("MPNConstants").MPNRedirect.FB_LOG_IN?d.actionOnInit=h.START_NEW_THREAD:d.props.redirectCommand==b("MPNConstants").MPNRedirect.GUEST_UPGRADE?d.actionOnInit=h.GUEST_UPGRADE:d.props.redirectCommand===b("MPNConstants").MPNRedirect.GUEST_UPGRADE_SWITCH_ACCOUNT&&(d.actionOnInit=h.GUEST_UPGRADE_SWITCH_ACCOUNT);d.ActionDelegate={onContinueAsGuest:d.onContinueAsGuest.bind(babelHelpers.assertThisInitialized(d)),openThreadWithCurrentFBUser:d.openThreadWithCurrentFBUser.bind(babelHelpers.assertThisInitialized(d)),openThreadWithInterstitial:d.openThreadWithInterstitial.bind(babelHelpers.assertThisInitialized(d)),onChatInMessenger:function(){},minimize:function(){b("MPNNavigation").minimizePlugin(d.context,!1)},maximize:function(){b("MPNNavigation").maximizePlugin(d.context,!1)}};d.$1=window.name;return d}var d=c.prototype;d.$4=function(){var a=this.props.redirectCommand;return a==b("MPNConstants").MPNRedirect.NEW_GUEST_SESSION||a==b("MPNConstants").MPNRedirect.FB_LOG_IN?b("MessagingPluginPathUtils").MPN_PATH.THREAD:this.props.path};d.componentDidMount=function(){this.$5(),b("MPNXDMessageManager").setupDesktopIframe(this.context.state.alignment),this.$6(),this.$7()};d.componentWillUnmount=function(){this.$3&&window.clearTimeout(this.$3)};d.componentDidUpdate=function(){this.$7()};d.$7=function(){var a=this,c=this.context.state,d=c.optimisticStorageState,e=c.pageID,f=c.pageName;c=c.accessToken;var g=b("MPNIdentity").MPNIdentity.currentUserID();if(this.$2==g||d.chatState===b("MPNLocalState").MPNChatState.CHAT_NOT_STARTED||g==null)return;d=b("MPNIdentity").MPNIdentity.currentUserState();d===b("MPNIdentity").MPNIdentityState.FB&&(b("LiveChatMqttClient").setUp(e,g,null,function(){return a.$2=g}),b("Bootloader").loadModules(["LiveChatPluginAlerts","MercurySyncDeltaHandler"],function(a,c){a.init(g,e,f,new Map(),!1,0),c.getForFBID(g),b("Arbiter").inform("MercurySyncDeltaHandler/initSeqID",{fbid:g,seqID:0})},"PRETestMPNDesktopWrapper.react"));d===b("MPNIdentity").MPNIdentityState.GUEST&&(c!=null&&(b("LiveChatMqttClient").setUp(e,g,null,null,c),this.$2=g))};d.$5=function(){var a=this;b("MPNXDMessageManager").setupIconIframe(this.$1,this.context.state.alignment);b("MPNXDMessageManager").subscribeEvent("plugin_wrapper","message","bubbleFrameLoaded",function(c){try{var d=a.context.state;if(c.data.frameName!=null){d=g.jsx(b("MPNDesktopIcon.react"),{threadColor:d.threadCSSColor,actionDelegate:a.ActionDelegate,pageID:d.pageID,pluginRequestTime:d.serverTime,initialVisibility:d.optimisticStorageState.visibility});var e=parent.frames[c.data.frameName].document.body;b("ReactDOM").render(d,e);a.iconIframeLoaded=!0}if(c.data.unreadCountFrameName!=null){d=g.jsx(b("MPNUnreadCountBadge.react"),{});e=parent.frames[c.data.unreadCountFrameName].document.body;b("ReactDOM").render(d,e)}a.$8()}catch(d){b("LiveChatPluginLoggerUtil").logImpressionExceptionsFromNewUI("tab_load_failure",a.context.state.pageID,"plugin_icon",d.name,d.message,d.stack,JSON.stringify({iconSrc:c.data.iconSrc,unreadSrc:c.data.unreadSrc}))}})};d.$8=function(){var a=this,b=this.context.state,c=b.greetingDialogDelay,d=b.greetingDialogDisplay;b=b.isInitialLoad;if(!b)return;b=!1;switch(d){case"show":case"unset":case"fade":b=c>0;break;case"hide":b=!1;break;default:break}if(!b)return;this.$3=window.setTimeout(function(){a.$9()},c)};d.$9=function(){this.context.state.optimisticStorageState.visibility==="hidden"&&b("MPNNavigation").maximizePlugin(this.context,!0)};d.$6=function(){var a=this;b("MPNXDMessageManager").subscribeEvent("plugin_wrapper","message","CustomerChat.SDK.Called",function(c){var d=a.context.state,e=d.pageID,f=d.greetingDialogDelay,g=d.threadCSSColor,h=d.loggedInGreeting;d=d.loggedOutGreeting;c=b("LiveChatPluginLoggerUtil").EVENTMAP[c.data.event];b("LiveChatPluginLoggerUtil").logImpressionEvents(c,e,JSON.stringify({greetingDialogDelay:f}),g,h,d)});b("MPNXDMessageManager").subscribeEvent("plugin_wrapper","message","updateCustomerChat",function(c){var d=a.context,e=d.state;d=d.dispatchAction;var f=e.loggedInGreeting,g=e.loggedOutGreeting;e=e.refParam;try{c=(c=c.data)==null?void 0:(c=c.message)==null?void 0:c.params;if(c==null)return;c=JSON.parse(c);var h=b("LiveChatPluginUtils").getSanitizedGreetingText(c.logged_in_greeting),i=b("LiveChatPluginUtils").getSanitizedGreetingText(c.logged_out_greeting);d({type:"SDK_UPDATE",loggedInGreeting:(d=h)!=null?d:f,loggedOutGreeting:(h=i)!=null?h:g,refParam:(d=c.ref)!=null?d:e})}catch(a){}});b("MPNXDMessageManager").subscribeEvent("plugin_wrapper","message","CustomerChat.isDialogHidden",function(c){c=((c=c.data.params)==null?void 0:c.is_dialog_hidden)==!0?"hidden":"not-hidden";b("MPNStorage").setVisibility(c);a.context.dispatchAction({type:"UPDATE_DIALOG_VISIBILITY",dialogVisibility:c})})};d.render=function(){this.actionOnInit==h.CREATE_GUEST_SESSION?(this.actionOnInit=h.NONE,this.onContinueAsGuest(function(){b("MPNStorage").clearRedirectCommand()})):this.actionOnInit==h.START_NEW_THREAD?(this.actionOnInit=h.NONE,b("MPNStorage").clearRedirectCommand(),this.openThreadWithCurrentFBUser()):this.actionOnInit==h.GUEST_UPGRADE?(this.actionOnInit=h.NONE,b("MPNStorage").clearRedirectCommand(),b("MessagingPluginGuestUpgradeActions").clearGuestStorage(this.context),b("MessagingPluginGuestUpgradeActions").setPluginStateToUpgradedThread(this.context)):this.actionOnInit==h.GUEST_UPGRADE_SWITCH_ACCOUNT&&(this.actionOnInit=h.NONE,b("MPNStorage").clearRedirectCommand(),b("MPNIdentity").MPNIdentity.subscribeLoggedInUserChanges(function(a,c){a=b("MPNStorage").getFBStorageState();a!=null&&b("MPNStorage").setFBStorageState(babelHelpers["extends"]({},a,{rdr:b("MPNConstants").MPNRedirect.GUEST_UPGRADE}));b("MPNXDMessageManager").reloadPlugin()},250));return this.context.state.optimisticStorageState.visibility=="not-hidden"||this.iconIframeLoaded?g.jsx(b("PRETestMPNDesktopRoute.react"),{path:this.initialPath,ActionDelegate:this.ActionDelegate}):null};d.$10=function(){var a=b("MPNStorage").getFBStorageState(),c=b("MPNIdentity").MPNIdentity.currentUserID();if(a==null||c==null)return;var d={path:b("MPNLocalState").MPNLocalStatePath.THREAD_VIEW,chatState:b("MPNLocalState").MPNChatState.LOGGED_IN_CHAT_STARTED,visibility:"not-hidden"};b("MPNStorage").setFBStorageState(babelHelpers["extends"]({},a,{currentPath:d.path,chatState:d.chatState,userID:c}));b("MPNStorage").setThirdPartyStorageState(d);this.context.dispatchAction({type:"START_CHAT",optimisticStorageState:d})};d.openThreadWithCurrentFBUser=function(){var a=this.context.state,c=a.pageID,d=a.requestID,e=a.refParam,f=a.refererUri;a=a.locale;c=b("XMNPlatformCustomerChatPluginOpenThreadController").getURIBuilder().setFBID("page_id",c).setString("ref",e).setString("referer_uri",f).setString("request_id",d).setString("locale",a).getRequest_LEGACY_UNTYPED(new(b("AsyncRequest"))());c.setAllowCrossPageTransition(!0).setMethod("POST").send();this.$10()};d.openThreadWithInterstitial=function(a){var c=this,d=this.context.state,e=d.pageID;d=d.requestID;new(b("PluginOptin"))("customer_chat").addLoginParams({logged_in:!0,page_id:e,request_id:d,switch_user:!1}).start();b("Arbiter").subscribeOnce(b("Plugin").CONNECT,function(){c.$10(),a!=null&&a()})};d.onContinueAsGuest=function(a){var c=this,d=this.context,e=d.state,f=d.dispatchAction,g=e.pageID,h=e.locale,i=e.requestID;b("CreateCustomerChatPluginGuestUserMutation").commit({input:{page_id:g,locale:h}},{onSuccess:function(c){var d,j;d=(d=c.create_customer_chat_plugin_guest_user)==null?void 0:d.session_key;j=(j=c.create_customer_chat_plugin_guest_user)==null?void 0:j.fbid;c=(c=c.create_customer_chat_plugin_guest_user)==null?void 0:c.access_token;if(d!=null&&j!=null&&c!=null){d=b("MPNStorage").getFBStorageState();var k={path:b("MPNLocalState").MPNLocalStatePath.THREAD_VIEW,chatState:b("MPNLocalState").MPNChatState.GUEST_CHAT_STARTED,visibility:"not-hidden",showUpgradePrompt:b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN};if(d!=null){var l=Date.now()+b("LiveChatPluginConstants").GUEST_SESSION_STORAGE_VALIDITY_MS;b("MPNStorage").setFBStorageState(babelHelpers["extends"]({},d,{currentPath:k.path,chatState:k.chatState,userID:j,accessToken:c,expirationTimestamp:l,showUpgradePrompt:b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN}))}b("MPNIdentity").MPNIdentity.changeIdentityToGuest(j,c);f({type:"START_CHAT",optimisticStorageState:k,accessToken:c,guestID:j});d=b("XMNPlatformCustomerChatPluginOpenThreadController").getURIBuilder().setFBID("page_id",g).setString("ref",e.refParam).setString("referer_uri",e.refererUri).setString("request_id",i).setString("access_token",c).setString("locale",h).getRequest_LEGACY_UNTYPED(new(b("AsyncRequest"))());d.setAllowCrossPageTransition(!0).setMethod("POST").send();a(j,c)}},onFailure:function(a){var d=a.message.match(/\"error\":([0-9]+)/);d=d&&d.length>=2?d[1]:null;d=JSON.stringify({maybe_error_code:d,domain:c.context.state.originDomain,request_id:c.context.state.requestID,error:a.message});b("LiveChatPluginLoggerUtil").logImpressionEvents("customer_chat_guest_account_creation_failed",g,d,null,null,null);b("MPNStorage").clearFBStorageState();b("MPNStorage").clearThirdPartyStorageState();b("MPNXDMessageManager").reloadPlugin()}})};return c}(g.Component);e.exports=a;a.contextType=b("MessagingPluginContext")}),null);
__d("PRETestMPNDesktopRoot",["cx","CometBlueBridgeKeyCommandListener.react","LiveChatPluginErrorBoundary.react","MessagingPluginPathUtils","MessagingPluginStateProvider","MPNConstants","MPNIdentity","MPNLocalState","MPNStorage","MPNXDMessageManager","PRETestMPNDesktopWrapper.react","React","ReactDOM","URI","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=b("React");a=function(){function a(a){var c=a.alignment,d=a.pageID,e=a.container,f=a.serverTime,g=a.pagePassesSentryTest,i=a.hasMessagingPermission,j=a.isMuted,k=a.isPageBlocked,l=a.isBusinessActive,m=a.reloaded,n=a.requestID,o=a.refererUri,p=a.originDomain,q=a.soundURLs,r=a.hasGuestMode,s=a.showUpgradeUpsellPrompt,t=a.appSwitchUri,u=a.upgradeAppSwitchUri,v=a.storedStates,w=a.isComposerDisabled,x=a.hasPersistentMenu,y=a.pageName,z=a.pageProfilePictureUri,A=a.viewerProfilePicureUri,B=a.pageResponsiveness,C=a.isInstantlyResponsive,D=a.refParam,E=a.pageVerifiedStatus,F=a.greetingDialogDelay,G=a.greetingDialogDisplay,H=a.greetingDialogFadeDelay,I=a.loggedInGreeting,J=a.loggedOutGreeting,K=a.threadCSSColor,L=a.locale;a=a.icebreakers;var M=(h||(h=b("performanceAbsoluteNow")))();try{this.$1(c,d,e,f,g,i,j,k,l,m,n,o,p,q,t,u,r,s,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,M,L,a)}catch(a){}}var c=a.prototype;c.$1=function(a,c,d,e,f,g,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){var P=this,Q=!1;b("MPNStorage").initialize(q,c,o);b("MPNIdentity").MPNIdentity.hasStorageAccess(function(n){b("MPNIdentity").MPNIdentity.init(n);var F=o,I=w;I||(I=P.$2(H,G),b("MPNStorage").setThirdPartyStorageState(I));var M=!1,R,S,T=I.visibility;if(n){b("MPNStorage").isAccessTokenExpired()&&(b("MPNStorage").clearFBStorageState(),I=P.$2(H,G),b("MPNStorage").setThirdPartyStorageState(I));var U=b("MPNStorage").getFBStorageState();if(U!=null&&U.requestID!=null&&U.requestID!=""){var V=U.requestID;(U.rdr==b("MPNConstants").MPNRedirect.NEW_GUEST_SESSION||U.rdr==b("MPNConstants").MPNRedirect.ITP_CONTINUE_SESSION)&&(F=V,b("MPNStorage").initialize(q,c,V))}Q=b("MPNStorage").setInitialStateIfNecessary(!1,T);U=b("MPNStorage").getFBStorageState();if(U!=null){M=U.chatState!=b("MPNLocalState").MPNChatState.CHAT_NOT_STARTED;R=U.accessToken;S=U.userID;T=U.visibility;I={path:U.currentPath,chatState:U.chatState,visibility:U.visibility,showUpgradePrompt:(V=U.showUpgradePrompt)!=null?V:b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN};b("MPNStorage").setThirdPartyStorageState(I)}}U=P.$3(n,w);T=="hidden"&&b("MPNXDMessageManager").updateAppearance(!0,!0,"false","false",null,a,"true",U);b("MPNIdentity").MPNIdentity.subscribeLoggedInUserChanges(function(a,c){b("MPNIdentity").MPNIdentity.currentUserState()!=b("MPNIdentity").MPNIdentityState.GUEST&&(b("MPNStorage").clearFBStorageState(),b("MPNStorage").clearThirdPartyStorageState()),b("MPNXDMessageManager").reloadPlugin()});V={alignment:a,pageID:c,pageName:z,pagePassesSentryTest:f,hasMessagingPermission:g,isMuted:k,isPageBlocked:l,pageProfilePictureUri:A,viewerProfilePicureUri:B,threadCSSColor:L,pageResponsiveness:C,isInstantlyResponsive:D,isComposerDisabled:x,hasPersistentMenu:y,greetingDialogDelay:G,greetingDialogDisplay:H,loggedInGreeting:J,loggedOutGreeting:K,refParam:E,refererUri:p,originDomain:q,appSwitchUri:s,upgradeAppSwitchUri:t,locale:N,isBusinessActive:m,icebreakers:O,initialRequestUri:(i||(i=b("URI"))).getRequestURI(),requestID:F,chatStarted:M,accessToken:R,guestID:S,optimisticStorageState:I,soundURLs:r,isInitialLoad:Q,hasGuestMode:u,showUpgradeUpsellPrompt:v,pluginMountTime:(h||(h=b("performanceAbsoluteNow")))(),serverTime:e,upgradeUpsellPrompt:b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN,messageCount:null,cookieAccessDenied:!1};b("ReactDOM").render(j.jsx(b("LiveChatPluginErrorBoundary.react"),{pageID:c,children:j.jsx(b("CometBlueBridgeKeyCommandListener.react"),{children:j.jsx(b("MessagingPluginStateProvider"),{initialState:V,children:j.jsx("div",{className:"_95ry",children:j.jsx(b("PRETestMPNDesktopWrapper.react"),{path:U,redirectCommand:b("MPNStorage").getRedirectCommand()})})})})}),d)})};c.$2=function(a,c){a=a==="hide"||c>0;return{path:b("MPNLocalState").MPNLocalStatePath.WELCOME_PAGE,chatState:b("MPNLocalState").MPNChatState.CHAT_NOT_STARTED,visibility:a?"hidden":"not-hidden",showUpgradePrompt:b("MPNConstants").MPNUpgradePrompt.NOT_SHOWN}};c.$3=function(a,c){var d=b("MessagingPluginPathUtils").MPN_PATH.WELCOME;if(a){a=b("MPNStorage").getFBStorageState();a!=null&&a.currentPath!=null?(d=b("MessagingPluginPathUtils").MessagingPluginPathUtils.toMobilePath(a.currentPath),b("MPNXDMessageManager").storeThirdPartyState(a.currentPath,a.chatState)):c!=null&&a==null&&b("MPNXDMessageManager").removeThirdPartyState()}else c!=null&&c.path!=null&&(d=b("MessagingPluginPathUtils").MessagingPluginPathUtils.toMobilePath(c.path)),d==b("MessagingPluginPathUtils").MPN_PATH.THREAD&&(d=b("MessagingPluginPathUtils").MPN_PATH.ITPCONTINUE);return d};return a}();e.exports=a}),null);